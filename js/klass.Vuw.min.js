!function(t,i){"use strict";if(!t)throw new Error("'Klass' isn't included.");if(!i)throw new Error("'jQuery' isn't included.");t.create("Vuw",{_ver:"1.0.1",$self:!1,$template:!1,_initialize:function(t){var i={name:"",selector:"",createTemplate:function(){},onReady:function(){},onReadyFirst:function(){},onReadyLast:function(){},onChangeState:function(){},render:function(){},renderComplete:function(){}};return i=this.isObject(t)?t:{},!i.name&&(i.name=String((new Date).valueOf())),this.isReady=!1,this.state={},this._onReadyCallbacks=[],this._onChangeStateCallbacks=[],this._stateBooked={},this._stateBookedCBs=[],this.setProp(i)},getProp:function(t){return this.hasOwnProperty(t)?this[t]:void 0},setProp:function(t,i,e){return t?this.isString(t)?this._setProp(t,i,!!e):this.isObject(t)&&(e=i===!0,t.onReady&&(this.onReady(t.onReady),delete t.onReady),t.onChangeState&&(this.onChangeState(t.onChangeState),delete t.onChangeState),Object.keys(t).forEach(function(i){this._setProp(i,t[i],e)},this)):csl.warn((this.name||"Vuw")+".setProp() ... arguments[0] is required."),this},_setProp:function(t,i,e){return this.hasOwnProperty(t)&&!e?csl.warn((this.name||"Vuw")+".setProp() ... '"+t+"' is already defined."):this[t]=i,this},_templateAreaPropTo:"_tmp",getTemplateArea:function(e){return t("Vuw")._$templateArea||(t("Vuw")._$templateArea=i("<div/>").addClass("vuw-template-area").hide().appendTo(document.body)),e===!1?t("Vuw")._$templateArea.get(0):t("Vuw")._$templateArea},getReady:function(){var t=i.Deferred();return this.isReady?(csl.log("** "+this.name+".getReady() is already executed."),t.resolve()):this.isGettingReady?(csl.log("** "+this.name+" is getting ready now..."),t.resolve()):(this.isGettingReady=!0,!!this.selector&&function(){var t;this.isString(this.selector)?t=i(this.selector):this.isFunction(this.selector)&&(t=this.selector.call(this)),t&&t instanceof i&&t.length&&(void 0!==t.attr("data-vuw-template")?(this.$template=t,t=i("<var/>").attr("data-vuw",this.name).insertBefore(this.$template),this.$self=t):(this.$self=t,i.data(this.$self.get(0),"vuw",this)))}.call(this),this.isFunction(this.createTemplate)&&function(){var t;t=this.createTemplate.call(this),t&&t instanceof i&&t.length&&(this.$template=t)}.call(this),!!this.$template&&this.$template.appendTo(this.getTemplateArea()),this.isReady=!0,i.when(this.isFunction(this.onReadyFirst)&&this.onReadyFirst(this.$self,this.$template)).then(function(){var t=this._onReadyCallbacks.map(function(t){return t.call(this,this.$self,this.$template)},this);return i.when.apply(i,t)}.bind(this)).then(function(){var t=Array.prototype.slice.call(arguments,0),e=i.Deferred();return i.when(this.isFunction(this.onReadyLast)?this.onReadyLast(this.$self,this.$template):void 0).then(function(){arguments.length&&void 0!==arguments[0]&&(t=t.concat(Array.prototype.slice.call(arguments,0))),e.resolve.apply(e,t)}.bind(this),e.reject.bind(e)),e.promise()}.bind(this)).then(function(){delete this.isGettingReady,t.resolve.apply(t,Array.prototype.slice.call(arguments,0))}.bind(this),t.reject.bind(t))),t.promise()},onReady:function(t){return this.isFunction(t)&&(this.isReady?(csl.log.gray(this.name+"... isReady to execute."),t.call(this,this.$self,this.$template)):this._onReadyCallbacks.push(t)),this},getState:function(t){return this.isReady?t&&this.isString(t)?this.state[t]:this.state:(csl.warn(this.name+".getState() ... getReady() didn't execute yet."),!1)},setState:function(t,e){var s=i.Deferred(),a=!1,n=!1;return this.isReady?t?this.isString(t)?this.isChangingState?(this._bookState(function(i){return i[t]=e,i}({}),s.resolve.bind(s)),n=!0):(this.state[t]=e,a=!0):this.isObject(t)?this.isChangingState?(this._bookState(t,s.resolve.bind(s)),n=!0):(this.state=t,a=!0):csl.warn(this.name+".setState() ... arguments error."):csl.warn(this.name+".setState() ... arguments[0] is required."):csl.warn(this.name+".setState() ... getReady() didn't execute yet."),a?this.changeState().then(function(){s.resolve.apply(s,Array.prototype.slice.call(arguments,0)),!!this.$self&&this.$self.trigger("changeState"),this._setStateBooked()}.bind(this),s.reject.bind(s)):n||s.reject(),s.promise()},_bookState:function(t,i){return Object.assign(this._stateBooked,t),this._stateBookedCBs.push(i),this},_setStateBooked:function(){var t;return Object.keys(this._stateBooked).length?(t=Object.assign({},this._stateBooked),this._stateBooked={},this.setState(t).then(function(){csl.log.gray(this.name+" ... set booked state",Object.assign({CB_count:this._stateBookedCBs.length},t));var i,e=this._stateBookedCBs.length;if(e){for(i=0;e>i;i++)this._stateBookedCBs[i]();this._stateBookedCBs=[]}}.bind(this))):!1},changeState:function(){var e,t=i.Deferred();return this.isChangingState=!0,e=this._onChangeStateCallbacks.map(function(t){return t.call(this,this.state)},this),i.when.apply(i,e).then(function(){var i=this._execRender(Array.prototype.slice.call(arguments,0));this.isChangingState=!1,t.resolve(i)}.bind(this),function(){this.isChangingState=!1,t.reject.apply(t,Array.prototype.slice(arguments,0))}),t.promise()},onChangeState:function(t){return this.isFunction(t)&&this._onChangeStateCallbacks.push(t),this},getCloneFromTemplate:function(){var t=!1;return this.$template&&(t=this.$template.clone().attr({id:null,"data-vuw-template":null}).removeClass("template")),t},_execRender:function(){var e,t=Array.prototype.slice.call(arguments,0);return t.unshift(this.state),t.unshift(this.getCloneFromTemplate()),e=this.render.apply(this,t),this.$self&&e&&(e instanceof i||!this.isElement(e)&&!this.isString(e)||(e=i(e)),e instanceof i&&e.length&&(this.$self.replaceWith(e),this.$self=e,i.data(this.$self.get(0),"vuw",this),this.isFunction(this.renderComplete)&&this.renderComplete(e))),e},render:function(){},renderComplete:function(){}}),t("Vuw").getVersion=function(){return this.prototype._ver},t("Vuw").useVuwer=function(){return csl.log.gray("** use vuwer (Vuw version:"+this.getVersion()+") **"),window.vuwer=t.new_("Vuw",{name:"vuwer",selector:function(){return i(window)},_vuwMap:{},childKlass:"VuwerComponent",_getComponentsReady:function(){var s,e=i.Deferred();return s=Object.keys(this._vuwMap).map(function(i){var e=this._vuwMap[i];return e instanceof t(this.childKlass)&&!e.isReady?e.getReady():void 0},this),i.when.apply(i,s).then(function(){var t=Object.keys(this._vuwMap),i={};Array.prototype.slice.call(arguments,0).forEach(function(e,s){Array.isArray(e)&&(e=e.filter(function(t){return!(!t||this.isObject(t)&&!Object.keys(t).length||this.isArray(t)&&!t.length)},this),!e.length&&(e=void 0)),void 0===e||(i[t[s]]=e)},this),this.isReady=!0,e.resolve(i)}.bind(this),e.reject.bind(e)),e.promise()},onReady:function(t){return this.$window=t,this._getComponentsReady()},add:function(i,e,s,a){var n,r;return"boolean"==typeof s&&(a=s),this.isString(i)?i in this._vuwMap&&!a?(csl.warn(this.name+".add() ... '"+i+"' is already defined."),this):(this.isObject(e)?e instanceof t(this.childKlass)&&(n=e):e={},n?n.container=this:(Object.assign(e,{name:i,container:this}),e.vuwType&&this.isString(e.vuwType)?(r="Vuw"+e.vuwType.slice(0,1).toUpperCase()+e.vuwType.slice(1),this.isFunction(t(r))||(r=this.childKlass,e.vuwType="component")):(r=this.childKlass,e.vuwType="component"),n=t.new_(r,e)),this._vuwMap[i]=n,this.isFunction(s)&&s.call(n),this):(csl.warn.red(this.name+".add() ... arguments[0] is must be string.",typeof i),this)},get:function(t){var i,e,s=!1;if(!this.isString(t))return csl.warn(this.name+".get() ... arguments[0] is must be string.",typeof t),s;if(s=this._vuwMap[t]||!1,!s&&/\./.test(t))for(e=t.split("."),s=this._vuwMap[e.pop()]||!1,i=e.length-1;i>=0&&s;i--){if(!s._vuwMap){s=!1;break}s=s._vuwMap[e[i]]||!1}return s},getChildren:function(){var i=Object.keys(this._vuwMap).map(function(t){return this[t]},this._vuwMap);return i.get=function(i){return t.isNumber(i)?this[i]||!1:this},i},find:function(i){var e=[];return this.getChildren().forEach(function(t){t.name===i&&e.push(t),e=e.concat(window.vuwer.find.call(t,i))},this),e.get=function(i){return t.isNumber(i)?this[i]||!1:this},e},remove:function(t){var i;return this.isString(t)?(i=this.get(t))?(i.$self&&i.$self.length&&i.$self.remove(),i.$template&&i.$template.length&&i.$template.remove(),delete this._vuwMap[t],this):this:(csl.warn(this.name+".remove() ... arguments[0] is must be string.",typeof t),this)},appendKlass:function(i,e,s){if(!this.isString(i))return csl.warn.red(this.name+".appendKlass() ... arguments[0] is must be string.",typeof i),this;if(t(i))return csl.warn.red(this.name+".appendKlass() ... '"+i+"' is already defined."),this;if(this.isString(s)){if(!this.isFunction(t(s)))return csl.warn(this.name+".appendKlass() ... '"+s+"' is undefined."),this}else{if(!this.isFunction(t(this.childKlass)))return csl.warn(this.name+".appendKlass() ... '"+this.childKlass+"' is undefined."),this;s=this.childKlass}return t.create(i).extends_(s,e),this}}),window.vuwer.appendKlass("VuwerComponent",{childKlass:"VuwerComponent",_initialize:function(i){return t("VuwerComponent").parent._initialize.call(this,i)?this.childKlass?this.isString(this.childKlass)&&t(this.childKlass)?(this._vuwMap={},this.onReady(window.vuwer._getComponentsReady.bind(this)),this):(csl.warn("VuwerComponent._initialize() ... 'childKlass' is must be Klass."),!1):(csl.warn("VuwerComponent._initialize() ... 'childKlass' is required prop."),!1):!1},add:function(){return window.vuwer.add.apply(this,Array.prototype.slice.call(arguments,0)),this},get:function(t){return window.vuwer.get.call(this,t)},getChildren:function(){return window.vuwer.getChildren.call(this)},find:function(t){return window.vuwer.find.call(this,t)},remove:function(t){var i=this.get(t);return i&&(i.getChildren().forEach(function(t){this.remove(t.name)},i),window.vuwer.remove.call(this,t)),this},getOther:function(t){return this.container.get(t)},getAddress:function(){var t=arguments.length?arguments[0]:[];return t.push(this.name),this.container&&this.container.getAddress?this.container.getAddress(t):t.join(".")},getCloneFromTemplate:function(){var e=this,s=t("Vuw").prototype.getCloneFromTemplate.call(this);return s&&s.find("[data-vuw]").each(function(){var n,t=i(this),s=t.data("vuw"),a=e.get(s);a&&(a.setProp("$self",t,!0),n=e.getState(s),e.isObject(n)&&a.setState(n))}),s}},"Vuw").appendKlass("VuwFade",{_initialize:function(e){return t("VuwFade").parent._initialize.call(this,e)?(this.onReady(function(t){var i;t&&(["absolute","fixed"].indexOf(t.css("position"))>=0&&(this.orgHeight=t.height()),t.addClass("vuw-fade").attr("data-visible",t.attr("data-visible")||"0"),i=parseFloat(t.css("transition-duration")),isNaN(i)?t.css("transition-duration",String(this.delay/1e3)+"s"):this.delay+=1e3*i)}),this.onChangeState(function(t){var e,s=t.visible?!0:!1;return this.$self?(e="1"===this.$self.attr("data-visible")?!0:!1,e===s?!1:i.Deferred(function(t){return!!this.orgHeight&&this.$self.css("height",this.orgHeight),this.$self.attr("data-visible",s?"1":""),setTimeout(function(){s||this.$self.attr("data-visible","0"),!!this.orgHeight&&this.$self.css("height",""),t.resolve()}.bind(this),this.delay),t.promise()}.bind(this))):(csl.log.red("  "+this.name+".onChangeState","$self is false."),!1)}),this):!1},delay:0},"VuwerComponent"),this._useVuwerAfter.forEach(function(t){t.call(this)},this),this},t("Vuw")._useVuwerAfter=[],t("Vuw").onUseVuwer=function(i){return t.isFunction(i)&&this._useVuwerAfter.push(i),this}}(window.Klass,window.jQuery||window.$);