!function(e,t){"use strict";if(!e)throw new Error("'Klass' isn't included.");if(!t)throw new Error("'jQuery' isn't included.");e.create("Vuw",{_ver:"1.0.0",$self:!1,$template:!1,_initialize:function(e){var t={name:"",selector:"",createTemplate:function(){},onReady:function(){},onReadyFirst:function(){},onReadyLast:function(){},onChangeState:function(){},render:function(){},renderComplete:function(){}};return t=this.isObject(e)?e:{},!t.name&&(t.name=String((new Date).valueOf())),this.isReady=!1,this.state={},this._onReadyCallbacks=[],this._onChangeStateCallbacks=[],this._stateBooked={},this._stateBookedCBs=[],this.setProp(t)},getProp:function(e){return this.hasOwnProperty(e)?this[e]:void 0},setProp:function(e,t,i){return e?this.isString(e)?this._setProp(e,t,!!i):this.isObject(e)&&(i=t===!0,e.onReady&&(this.onReady(e.onReady),delete e.onReady),e.onChangeState&&(this.onChangeState(e.onChangeState),delete e.onChangeState),Object.keys(e).forEach(function(t){this._setProp(t,e[t],i)},this)):csl.warn((this.name||"Vuw")+".setProp() ... arguments[0] is required."),this},_setProp:function(e,t,i){return this.hasOwnProperty(e)&&!i?csl.warn((this.name||"Vuw")+".setProp() ... '"+e+"' is already defined."):this[e]=t,this},_templateAreaPropTo:"_tmp",getTemplateArea:function(i){return e("Vuw")._$templateArea||(e("Vuw")._$templateArea=t("<div/>").addClass("vuw-template-area").hide().appendTo(document.body)),i===!1?e("Vuw")._$templateArea.get(0):e("Vuw")._$templateArea},getReady:function(){var e=t.Deferred();return this.isReady?(csl.log("** "+this.name+".getReady() is already executed."),e.resolve()):this.isGettingReady?(csl.log("** "+this.name+" is getting ready now..."),e.resolve()):(this.isGettingReady=!0,!!this.selector&&function(){var e;this.isString(this.selector)?e=t(this.selector):this.isFunction(this.selector)&&(e=this.selector.call(this)),e&&e instanceof t&&e.length&&(void 0!==e.attr("data-vuw-template")?(this.$template=e,e=t("<var/>").attr("data-vuw",this.name).insertBefore(this.$template),this.$self=e):(this.$self=e,t.data(this.$self.get(0),"vuw",this)))}.call(this),this.isFunction(this.createTemplate)&&function(){var e;e=this.createTemplate.call(this),e&&e instanceof t&&e.length&&(this.$template=e)}.call(this),!!this.$template&&this.$template.appendTo(this.getTemplateArea()),this.isReady=!0,t.when(this.isFunction(this.onReadyFirst)&&this.onReadyFirst(this.$self,this.$template)).then(function(){var e=this._onReadyCallbacks.map(function(e){return e.call(this,this.$self,this.$template)},this);return t.when.apply(t,e)}.bind(this)).then(function(){var e=Array.prototype.slice.call(arguments,0),i=t.Deferred();return t.when(this.isFunction(this.onReadyLast)?this.onReadyLast(this.$self,this.$template):void 0).then(function(){arguments.length&&void 0!==arguments[0]&&(e=e.concat(Array.prototype.slice.call(arguments,0))),i.resolve.apply(i,e)}.bind(this),i.reject.bind(i)),i.promise()}.bind(this)).then(function(){delete this.isGettingReady,e.resolve.apply(e,Array.prototype.slice.call(arguments,0))}.bind(this),e.reject.bind(e))),e.promise()},onReady:function(e){return this.isFunction(e)&&(this.isReady?(csl.log.gray(this.name+"... isReady to execute."),e.call(this,this.$self,this.$template)):this._onReadyCallbacks.push(e)),this},getState:function(e){return this.isReady?e&&this.isString(e)?this.state[e]:this.state:(csl.warn(this.name+".getState() ... getReady() didn't execute yet."),!1)},setState:function(e,i){var a=t.Deferred(),n=!1,s=!1;return this.isReady?e?this.isString(e)?this.isChangingState?(this._bookState(function(t){return t[e]=i,t}({}),a.resolve.bind(a)),s=!0):(this.state[e]=i,n=!0):this.isObject(e)?this.isChangingState?(this._bookState(e,a.resolve.bind(a)),s=!0):(this.state=e,n=!0):csl.warn(this.name+".setState() ... arguments error."):csl.warn(this.name+".setState() ... arguments[0] is required."):csl.warn(this.name+".setState() ... getReady() didn't execute yet."),n?this.changeState().then(function(){a.resolve.apply(a,Array.prototype.slice.call(arguments,0)),!!this.$self&&this.$self.trigger("changeState"),this._setStateBooked()}.bind(this),a.reject.bind(a)):s||a.reject(),a.promise()},_bookState:function(e,t){return Object.assign(this._stateBooked,e),this._stateBookedCBs.push(t),this},_setStateBooked:function(){var e;return Object.keys(this._stateBooked).length?(e=Object.assign({},this._stateBooked),this._stateBooked={},this.setState(e).then(function(){csl.log.gray(this.name+" ... set booked state",Object.assign({CB_count:this._stateBookedCBs.length},e));var t,i=this._stateBookedCBs.length;if(i){for(t=0;i>t;t++)this._stateBookedCBs[t]();this._stateBookedCBs=[]}}.bind(this))):!1},changeState:function(){var i,e=t.Deferred();return this.isChangingState=!0,i=this._onChangeStateCallbacks.map(function(e){return e.call(this,this.state)},this),t.when.apply(t,i).then(function(){var t=this._execRender(Array.prototype.slice.call(arguments,0));this.isChangingState=!1,e.resolve(t)}.bind(this),function(){this.isChangingState=!1,e.reject.apply(e,Array.prototype.slice(arguments,0))}),e.promise()},onChangeState:function(e){return this.isFunction(e)&&this._onChangeStateCallbacks.push(e),this},getCloneFromTemplate:function(){var e=!1;return this.$template&&(e=this.$template.clone().attr({id:null,"data-vuw-template":null}).removeClass("template")),e},_execRender:function(){var i,e=Array.prototype.slice.call(arguments,0);return e.unshift(this.state),e.unshift(this.getCloneFromTemplate()),i=this.render.apply(this,e),this.$self&&i&&(i instanceof t||!this.isElement(i)&&!this.isString(i)||(i=t(i)),i instanceof t&&i.length&&(this.$self.replaceWith(i),this.$self=i,t.data(this.$self.get(0),"vuw",this),this.isFunction(this.renderComplete)&&this.renderComplete(i))),i},render:function(){},renderComplete:function(){}}),e("Vuw").getVersion=function(){return this.prototype._ver},e("Vuw").useVuwer=function(){return csl.log.gray("** use vuwer (Vuw version:"+this.getVersion()+") **"),window.vuwer=e.new_("Vuw",{name:"vuwer",selector:function(){return t(window)},_vuwMap:{},childKlass:"VuwerComponent",_getComponentsReady:function(){var a,i=t.Deferred();return a=Object.keys(this._vuwMap).map(function(t){var i=this._vuwMap[t];return i instanceof e(this.childKlass)&&!i.isReady?i.getReady():void 0},this),t.when.apply(t,a).then(function(){var e=Object.keys(this._vuwMap),t={};Array.prototype.slice.call(arguments,0).forEach(function(i,a){Array.isArray(i)&&(i=i.filter(function(e){return!(!e||this.isObject(e)&&!Object.keys(e).length||this.isArray(e)&&!e.length)},this),!i.length&&(i=void 0)),void 0===i||(t[e[a]]=i)},this),this.isReady=!0,i.resolve(t)}.bind(this),i.reject.bind(i)),i.promise()},onReady:function(e){return this.$window=e,this._getComponentsReady()},add:function(t,i,a,n){var s,r;return"boolean"==typeof a&&(n=a),this.isString(t)?t in this._vuwMap&&!n?(csl.warn(this.name+".add() ... '"+t+"' is already defined."),this):(this.isObject(i)?i instanceof e(this.childKlass)&&(s=i):i={},s||(Object.assign(i,{name:t}),i.vuwType&&this.isString(i.vuwType)?(r="Vuw"+i.vuwType.slice(0,1).toUpperCase()+i.vuwType.slice(1),this.isFunction(e(r))||(r=this.childKlass,i.vuwType="component")):(r=this.childKlass,i.vuwType="component"),s=e.new_(r,i)),this._vuwMap[t]=s,s.container=this,this.isFunction(a)&&a.call(s),this):(csl.warn.red(this.name+".add() ... arguments[0] is must be string.",typeof t),this)},get:function(e){var t,i,a=!1;if(!this.isString(e))return csl.warn(this.name+".get() ... arguments[0] is must be string.",typeof e),a;if(a=this._vuwMap[e]||!1,!a&&/\./.test(e))for(i=e.split("."),a=this._vuwMap[i.pop()]||!1,t=i.length-1;t>=0&&a;t--){if(!a._vuwMap){a=!1;break}a=a._vuwMap[i[t]]||!1}return a},getChildren:function(){return Object.keys(this._vuwMap).map(function(e){return this[e]},this._vuwMap)},remove:function(e){var t;return this.isString(e)?(t=this.get(e))?(t.$self&&t.$self.length&&t.$self.remove(),t.$template&&t.$template.length&&t.$template.remove(),delete this._vuwMap[e],this):this:(csl.warn(this.name+".remove() ... arguments[0] is must be string.",typeof e),this)},appendKlass:function(t,i,a){if(!this.isString(t))return csl.warn.red(this.name+".appendKlass() ... arguments[0] is must be string.",typeof t),this;if(e(t))return csl.warn.red(this.name+".appendKlass() ... '"+t+"' is already defined."),this;if(this.isString(a)){if(!this.isFunction(e(a)))return csl.warn(this.name+".appendKlass() ... '"+a+"' is undefined."),this}else{if(!this.isFunction(e(this.childKlass)))return csl.warn(this.name+".appendKlass() ... '"+this.childKlass+"' is undefined."),this;a=this.childKlass}return e.create(t).extends_(a,i),this}}),window.vuwer.appendKlass("VuwerComponent",{childKlass:"VuwerComponent",_initialize:function(t){return e("VuwerComponent").parent._initialize.call(this,t)?this.childKlass?this.isString(this.childKlass)&&e(this.childKlass)?(this._vuwMap={},this.onReady(window.vuwer._getComponentsReady.bind(this)),this):(csl.warn("VuwerComponent._initialize() ... 'childKlass' is must be Klass."),!1):(csl.warn("VuwerComponent._initialize() ... 'childKlass' is required prop."),!1):!1},add:function(){return window.vuwer.add.apply(this,Array.prototype.slice.call(arguments,0)),this},get:function(e){return window.vuwer.get.call(this,e)},getChildren:function(){return window.vuwer.getChildren.call(this)},remove:function(e){window.vuwer.remove.call(this,e),this.isString(e)&&window.vuwer.remove(e+"."+this.name)},getOther:function(e){return this.container.get(e)},getAddress:function(){var e=arguments.length?arguments[0]:[];return e.push(this.name),this.container&&this.container.getAddress?this.container.getAddress(e):e.join(".")},getCloneFromTemplate:function(){var i=this,a=e("Vuw").prototype.getCloneFromTemplate.call(this);return a&&a.find("[data-vuw]").each(function(){var s,e=t(this),a=e.data("vuw"),n=i.getOther(a);n&&(n.setProp("$self",e,!0),s=i.getState(a),i.isObject(s)&&n.setState(s))}),a}},"Vuw").appendKlass("VuwFade",{_initialize:function(i){return e("VuwFade").parent._initialize.call(this,i)?(this.onReady(function(e){var t;e&&(["absolute","fixed"].indexOf(e.css("position"))>=0&&(this.orgHeight=e.height()),e.addClass("vuw-fade").attr("data-visible",e.attr("data-visible")||"0"),t=parseFloat(e.css("transition-duration")),isNaN(t)?e.css("transition-duration",String(this.delay/1e3)+"s"):this.delay+=1e3*t)}),this.onChangeState(function(e){var i,a=e.visible?!0:!1;return this.$self?(i="1"===this.$self.attr("data-visible")?!0:!1,i===a?!1:t.Deferred(function(e){return!!this.orgHeight&&this.$self.css("height",this.orgHeight),this.$self.attr("data-visible",a?"1":""),setTimeout(function(){a||this.$self.attr("data-visible","0"),!!this.orgHeight&&this.$self.css("height",""),e.resolve()}.bind(this),this.delay),e.promise()}.bind(this))):(csl.log.red("  "+this.name+".onChangeState","$self is false."),!1)}),this):!1},delay:0},"VuwerComponent"),this._useVuwerAfter.forEach(function(e){e.call(this)},this),this},e("Vuw")._useVuwerAfter=[],e("Vuw").onUseVuwer=function(t){return e.isFunction(t)&&this._useVuwerAfter.push(t),this}}(window.Klass,window.jQuery||window.$);