!function(t,e){"use strict";if(!t)throw new Error("'Klass' isn't included.");if(!e)throw new Error("'jQuery' isn't included.");t.create("Vuw",{_ver:"1.0.0",$self:!1,$template:!1,_initialize:function(t){var e={name:"",selector:"",createTemplate:function(){},onReady:function(){},onReadyFirst:function(){},onReadyLast:function(){},onChangeState:function(){},render:function(){},renderComplete:function(){}};return e=this.isObject(t)?t:{},!e.name&&(e.name=String((new Date).valueOf())),this.isReady=!1,this.state={},this._onReadyCallbacks=[],this._onChangeStateCallbacks=[],this._stateBooked={},this._stateBookedCBs=[],this.setProp(e)},getProp:function(t){return this.hasOwnProperty(t)?this[t]:void 0},setProp:function(t,e,a){return t?this.isString(t)?this._setProp(t,e,!!a):this.isObject(t)&&(a=e===!0,t.onReady&&(this.onReady(t.onReady),delete t.onReady),t.onChangeState&&(this.onChangeState(t.onChangeState),delete t.onChangeState),Object.keys(t).forEach(function(e){this._setProp(e,t[e],a)},this)):csl.warn((this.name||"Vuw")+".setProp() ... arguments[0] is required."),this},_setProp:function(t,e,a){return this.hasOwnProperty(t)&&!a?csl.warn((this.name||"Vuw")+".setProp() ... '"+t+"' is already defined."):this[t]=e,this},_templateAreaPropTo:"_tmp",getTemplateArea:function(a){return t("Vuw")._$templateArea||(t("Vuw")._$templateArea=e("<div/>").addClass("vuw-template-area").hide().appendTo(document.body)),a===!1?t("Vuw")._$templateArea.get(0):t("Vuw")._$templateArea},getReady:function(){var t=e.Deferred();return this.isReady?(csl.log("** "+this.name+".getReady() is already executed."),t.resolve()):this.isGettingReady?(csl.log("** "+this.name+" is getting ready now..."),t.resolve()):(this.isGettingReady=!0,!!this.selector&&function(){var t;this.isString(this.selector)?t=e(this.selector):this.isFunction(this.selector)&&(t=this.selector.call(this)),t&&t instanceof e&&t.length&&(void 0!==t.attr("data-vuw-template")?(this.$template=t,t=e("<var/>").attr("data-vuw",this.name).insertBefore(this.$template),this.$self=t):(this.$self=t,e.data(this.$self.get(0),"vuw",this)))}.call(this),this.isFunction(this.createTemplate)&&function(){var t;t=this.createTemplate.call(this),t&&t instanceof e&&t.length&&(this.$template=t)}.call(this),!!this.$template&&this.$template.appendTo(this.getTemplateArea()),this.isReady=!0,e.when(this.isFunction(this.onReadyFirst)&&this.onReadyFirst(this.$self,this.$template)).then(function(){var t=this._onReadyCallbacks.map(function(t){return t.call(this,this.$self,this.$template)},this);return e.when.apply(e,t)}.bind(this)).then(function(){var t=Array.prototype.slice.call(arguments,0),a=e.Deferred();return e.when(this.isFunction(this.onReadyLast)?this.onReadyLast(this.$self,this.$template):void 0).then(function(){arguments.length&&void 0!==arguments[0]&&(t=t.concat(Array.prototype.slice.call(arguments,0))),a.resolve.apply(a,t)}.bind(this),a.reject.bind(a)),a.promise()}.bind(this)).then(function(){delete this.isGettingReady,t.resolve.apply(t,Array.prototype.slice.call(arguments,0))}.bind(this),t.reject.bind(t))),t.promise()},onReady:function(t){return this.isFunction(t)&&(this.isReady?(csl.log.gray(this.name+"... isReady to execute."),t.call(this,this.$self,this.$template)):this._onReadyCallbacks.push(t)),this},getState:function(t){return this.isReady?t&&this.isString(t)?this.state[t]:this.state:(csl.warn(this.name+".getState() ... getReady() didn't execute yet."),!1)},setState:function(t,a){var i=e.Deferred(),s=!1,n=!1;return this.isReady?t?this.isString(t)?this.isChangingState?(this._bookState(function(e){return e[t]=a,e}({}),i.resolve.bind(i)),n=!0):(this.state[t]=a,s=!0):this.isObject(t)?this.isChangingState?(this._bookState(t,i.resolve.bind(i)),n=!0):(this.state=t,s=!0):csl.warn(this.name+".setState() ... arguments error."):csl.warn(this.name+".setState() ... arguments[0] is required."):csl.warn(this.name+".setState() ... getReady() didn't execute yet."),s?this.changeState().then(function(){i.resolve.apply(i,Array.prototype.slice.call(arguments,0)),!!this.$self&&this.$self.trigger("changeState"),this._setStateBooked()}.bind(this),i.reject.bind(i)):n||i.reject(),i.promise()},_bookState:function(t,e){return Object.assign(this._stateBooked,t),this._stateBookedCBs.push(e),this},_setStateBooked:function(){var t;return Object.keys(this._stateBooked).length?(t=Object.assign({},this._stateBooked),this._stateBooked={},this.setState(t).then(function(){csl.log.gray(this.name+" ... set booked state",Object.assign({CB_count:this._stateBookedCBs.length},t));var e,a=this._stateBookedCBs.length;if(a){for(e=0;a>e;e++)this._stateBookedCBs[e]();this._stateBookedCBs=[]}}.bind(this))):!1},changeState:function(){var a,t=e.Deferred();return this.isChangingState=!0,a=this._onChangeStateCallbacks.map(function(t){return t.call(this,this.state)},this),e.when.apply(e,a).then(function(){var e=this._execRender(Array.prototype.slice.call(arguments,0));this.isChangingState=!1,t.resolve(e)}.bind(this),function(){this.isChangingState=!1,t.reject.apply(t,Array.prototype.slice(arguments,0))}),t.promise()},onChangeState:function(t){return this.isFunction(t)&&this._onChangeStateCallbacks.push(t),this},getCloneFromTemplate:function(){var t=!1;return this.$template&&(t=this.$template.clone().attr({id:null,"data-vuw-template":null}).removeClass("template")),t},_execRender:function(){var a,t=Array.prototype.slice.call(arguments,0);return t.unshift(this.state),t.unshift(this.getCloneFromTemplate()),a=this.render.apply(this,t),this.$self&&a&&(a instanceof e||!this.isElement(a)&&!this.isString(a)||(a=e(a)),a instanceof e&&a.length&&(this.$self.replaceWith(a),this.$self=a,e.data(this.$self.get(0),"vuw",this),this.isFunction(this.renderComplete)&&this.renderComplete(a))),a},render:function(){},renderComplete:function(){}}),t("Vuw").getVersion=function(){return this.prototype._ver},t("Vuw").useVuwer=function(){return csl.log.gray("** use vuwer (Vuw version:"+this.getVersion()+") **"),window.vuwer=t.new_("Vuw",{name:"vuwer",selector:function(){return e(window)},_vuwMap:{},childKlass:"VuwerComponent",_getComponentsReady:function(){var i,a=e.Deferred();return i=Object.keys(this._vuwMap).map(function(e){var a=this._vuwMap[e];return a instanceof t(this.childKlass)&&!a.isReady?a.getReady():void 0},this),e.when.apply(e,i).then(function(){var t=Object.keys(this._vuwMap),e={};Array.prototype.slice.call(arguments,0).forEach(function(a,i){Array.isArray(a)&&(a=a.filter(function(t){return!(!t||this.isObject(t)&&!Object.keys(t).length||this.isArray(t)&&!t.length)},this),!a.length&&(a=void 0)),void 0===a||(e[t[i]]=a)},this),this.isReady=!0,a.resolve(e)}.bind(this),a.reject.bind(a)),a.promise()},onReady:function(t){return this.$window=t,this._getComponentsReady()},add:function(e,a,i,s){var n,r;return"boolean"==typeof i&&(s=i),this.isString(e)?e in this._vuwMap&&!s?(csl.warn(this.name+".add() ... '"+e+"' is already defined."),this):(this.isObject(a)?a instanceof t(this.childKlass)&&(n=a):a={},n||(Object.assign(a,{name:e}),a.vuwType&&this.isString(a.vuwType)?(r="Vuw"+a.vuwType.slice(0,1).toUpperCase()+a.vuwType.slice(1),this.isFunction(t(r))||(r=this.childKlass,a.vuwType="component")):(r=this.childKlass,a.vuwType="component"),n=t.new_(r,a)),this._vuwMap[e]=n,n.container=this,this.isFunction(i)&&i.call(n),this):(csl.warn.red(this.name+".add() ... arguments[0] is must be string.",typeof e),this)},get:function(t){var e,a,i=!1;if(!this.isString(t))return csl.warn(this.name+".get() ... arguments[0] is must be string.",typeof t),i;if(i=this._vuwMap[t]||!1,!i&&/\./.test(t))for(a=t.split("."),i=this._vuwMap[a.pop()]||!1,e=a.length-1;e>=0&&i;e--){if(!i._vuwMap){i=!1;break}i=i._vuwMap[a[e]]||!1}return i},getChildren:function(){return Object.keys(this._vuwMap).map(function(t){return this[t]},this._vuwMap)},remove:function(t){var e;return this.isString(t)?(e=this.get(t))?(e.$self&&e.$self.length&&e.$self.remove(),e.$template&&e.$template.length&&e.$template.remove(),delete this._vuwMap[t],this):this:(csl.warn(this.name+".remove() ... arguments[0] is must be string.",typeof t),this)},appendKlass:function(e,a,i){if(!this.isString(e))return csl.warn.red(this.name+".appendKlass() ... arguments[0] is must be string.",typeof e),this;if(t(e))return csl.warn.red(this.name+".appendKlass() ... '"+e+"' is already defined."),this;if(this.isString(i)){if(!this.isFunction(t(i)))return csl.warn(this.name+".appendKlass() ... '"+i+"' is undefined."),this}else{if(!this.isFunction(t(this.childKlass)))return csl.warn(this.name+".appendKlass() ... '"+this.childKlass+"' is undefined."),this;i=this.childKlass}return t.create(e).extends_(i,a),this}}),window.vuwer.appendKlass("VuwerComponent",{childKlass:"VuwerComponent",_initialize:function(e){return t("VuwerComponent").parent._initialize.call(this,e)?this.childKlass?this.isString(this.childKlass)&&t(this.childKlass)?(this._vuwMap={},this.onReady(window.vuwer._getComponentsReady.bind(this)),this):(csl.warn("VuwerComponent._initialize() ... 'childKlass' is must be Klass."),!1):(csl.warn("VuwerComponent._initialize() ... 'childKlass' is required prop."),!1):!1},add:function(){return window.vuwer.add.apply(this,Array.prototype.slice.call(arguments,0)),this},get:function(t){return window.vuwer.get.call(this,t)},getChildren:function(){return window.vuwer.getChildren.call(this)},remove:function(t){window.vuwer.remove.call(this,t),this.isString(t)&&window.vuwer.remove(t+"."+this.name)},getOther:function(t){return this.container.get(t)},getAddress:function(){var t=arguments.length?arguments[0]:[];return t.push(this.name),this.container&&this.container.getAddress?this.container.getAddress(t):t.join(".")},getCloneFromTemplate:function(){var a=this,i=t("Vuw").prototype.getCloneFromTemplate.call(this);return i&&i.find("[data-vuw]").each(function(){var n,t=e(this),i=t.data("vuw"),s=a.getOther(i);s&&(s.setProp("$self",t,!0),n=a.getState(i),a.isObject(n)&&s.setState(n))}),i}},"Vuw").appendKlass("VuwFade",{_initialize:function(a){return t("VuwFade").parent._initialize.call(this,a)?(this.onReady(function(t){var e;t&&(["absolute","fixed"].indexOf(t.css("position"))>=0&&(this.orgHeight=t.height()),t.addClass("vuw-fade").attr("data-visible",t.attr("data-visible")||"0"),e=parseFloat(t.css("transition-duration")),isNaN(e)?t.css("transition-duration",String(this.delay/1e3)+"s"):this.delay+=1e3*e)}),this.onChangeState(function(t){var a,i=t.visible?!0:!1;return this.$self?(a="1"===this.$self.attr("data-visible")?!0:!1,a===i?!1:e.Deferred(function(t){return!!this.orgHeight&&this.$self.css("height",this.orgHeight),this.$self.attr("data-visible",i?"1":""),setTimeout(function(){i||this.$self.attr("data-visible","0"),!!this.orgHeight&&this.$self.css("height",""),t.resolve()}.bind(this),this.delay),t.promise()}.bind(this))):(csl.log.red("  "+this.name+".onChangeState","$self is false."),!1)}),this):!1},delay:0},"VuwerComponent"),this}}(window.Klass,window.jQuery||window.$);